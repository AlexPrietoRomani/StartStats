% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_analysis.R
\name{run_analysis}
\alias{run_analysis}
\title{Análisis Estadístico Integral para Datos Agronómicos}
\usage{
run_analysis(var_name, data, formula, response_type = "quantitative")
}
\arguments{
\item{var_name}{Un string. El nombre de la columna que contiene la variable respuesta a analizar.}

\item{data}{Un data.frame. El conjunto de datos que contiene \code{var_name} y los predictores.}

\item{formula}{Una fórmula. La fórmula del modelo que define los factores predictores
(ej: \code{~ Factor1 * Factor2 * Factor3}), sin incluir la variable respuesta.}

\item{response_type}{Un string. El tipo de variable respuesta. Puede ser \code{"quantitative"}
(por defecto) o \code{"ordinal"}. Determina el flujo de análisis.}
}
\value{
Una lista con los resultados de los análisis, incluyendo:
\describe{
\item{\code{type}}{El tipo de análisis realizado ("quantitative" o "ordinal").}
\item{\code{variable}}{El nombre de la variable respuesta analizada.}
\item{\code{quantitative_results}}{Una lista (presente si \code{type = "quantitative"}) que incluye:
\itemize{
\item \code{anova_table}: La tabla ANOVA tipo III del modelo lineal (\code{car::Anova}).
\item \code{normality_tests}: Una lista con los resultados de las pruebas de normalidad
(Shapiro-Wilk, Anderson-Darling, Lilliefors).
\item \code{normal_ok}: Booleano indicando si la normalidad residual es aceptada (TRUE/FALSE).
\item \code{homoscedasticity_test}: El objeto de resultado de la prueba de Levene (\code{car::leveneTest}).
\item \code{homoscedastic_ok}: Booleano indicando si la homocedasticidad es aceptada (TRUE/FALSE).
\item \code{posthoc_recommendation}: Un string con la sugerencia de prueba post-hoc (Tukey HSD o Games-Howell).
\item \code{art_anova_table}: (Opcional) La tabla ANOVA ART si los supuestos no se cumplen.
}}
\item{\code{ordinal_results}}{Una lista (presente si \code{type = "ordinal"}) que incluye:
\itemize{
\item \code{kruskal_wallis_table}: La tabla resumen de las pruebas de Kruskal-Wallis para cada término.
\item \code{posthoc_recommendation}: Un string con la sugerencia de post-hoc para ordinales.
}}
}
Si no se cumplen las condiciones para un análisis específico (ej. no hay datos completos para ART),
los elementos correspondientes en la lista de resultados pueden contener mensajes informativos o \code{NULL}.
La función también imprime un resumen del progreso y los resultados clave en la consola para feedback inmediato.
}
\description{
Realiza un análisis estadístico completo para una variable respuesta, incluyendo
ANOVA tipo III para variables cuantitativas o pruebas no paramétricas para ordinales.
Incorpora validación de supuestos (normalidad y homocedasticidad) y sugiere
pruebas post-hoc. Si los supuestos fallan para variables cuantitativas,
ejecuta un Análisis de Rangos Alineados (ART ANOVA).
}
\details{
Esta función maneja dos tipos principales de variables respuesta:

\strong{Para \code{response_type = "quantitative"} (cuantitativa):}
\enumerate{
\item \strong{Ajuste del Modelo Lineal:} Se ajusta un modelo lineal (\code{lm()}) con contrastes
sum-to-zero para la variable respuesta y los factores definidos en \code{formula}.
\item \strong{ANOVA Tipo III:} Se realiza un análisis de varianza tipo III usando \code{car::Anova()},
adecuado para diseños desbalanceados o con interacciones.
\item \strong{Verificación de Normalidad:}
\itemize{
\item Para \code{n < 50} observaciones, se aplica la prueba de Shapiro-Wilk.
\item Para \verb{n ≥ 50} observaciones, se aplican las pruebas de Anderson-Darling y Lilliefors.
Se evalúa la normalidad de los residuos del modelo lineal.
}
\item \strong{Verificación de Homocedasticidad:} Se usa la prueba de Levene (\code{car::leveneTest()})
para evaluar la homogeneidad de varianzas entre los grupos formados por la interacción
de todos los predictores.
\item \strong{Sugerencia de Post-Hoc:} Se recomienda Tukey HSD si se cumple la homocedasticidad,
o Games-Howell si se detecta heterocedasticidad.
\item \strong{Análisis ART (Aligned Rank Transform):} Si los supuestos de normalidad Y
homocedasticidad fallan, se ejecuta un ART ANOVA (\code{ARTool::art()} y \code{anova()})
como alternativa no paramétrica robusta para diseños factoriales.
Se verifica la existencia de datos completos antes de ejecutar ART.
}

\strong{Para \code{response_type = "ordinal"} (ordinal):}
\enumerate{
\item \strong{Preparación de Datos:} Se seleccionan y filtran los datos, convirtiendo los predictores
a factores.
\item \strong{Pruebas de Kruskal-Wallis:} Se realiza una prueba de Kruskal-Wallis independiente
para cada efecto principal y para la interacción total definida en la \code{formula}.
Esta es una aproximación no paramétrica al ANOVA para datos ordinales. Se verifica
la existencia de datos completos antes de ejecutar las pruebas.
\item \strong{Reporte de Significancia:} Se presenta una tabla con los resultados (Chi-cuadrado,
grados de libertad, p-valor) y códigos de significancia.
\item \strong{Recomendación Post-Hoc:} Se sugiere un post-hoc adecuado como Dunn con Bonferroni
si algún término resulta significativo.
}
}
\examples{
# Crear datos de ejemplo (el mismo usado en generate_groups)
set.seed(123)
df_ejemplo <- data.frame(
  genotipo = rep(c("G1", "G2", "G3", "G4", "Control"), each = 20),
  rendimiento = c(rnorm(20, 50, 5), rnorm(20, 55, 5), rnorm(20, 45, 5), rnorm(20, 70, 5), rnorm(20, 52, 5)),
  rendimiento_log = c(log(rnorm(20, 50, 5)), log(rnorm(20, 55, 5)), log(rnorm(20, 45, 5)), log(rnorm(20, 70, 5)), log(rnorm(20, 52, 5))),
  sabor_score = sample(1:5, 100, replace = TRUE, prob = c(0.1, 0.2, 0.3, 0.2, 0.2))
)
# Introducir algunos outliers y NAs para probar robustez
df_ejemplo$rendimiento[c(5, 25, 45, 85)] <- c(10, 100, NA, 15)
df_ejemplo$sabor_score[c(10, 30, 90)] <- NA

# Ejemplo 1: Análisis para una variable cuantitativa (Rendimiento)
\dontrun{
resultados_rendimiento <- run_analysis(
  var_name = "rendimiento",
  data = df_ejemplo,
  formula = ~ genotipo * tratamiento, # Ejemplo de formula con interacción
  response_type = "quantitative"
)
print(resultados_rendimiento$quantitative_results$anova_table)
# Acceder a otros resultados:
# print(resultados_rendimiento$quantitative_results$normality_tests)
}

# Ejemplo 2: Análisis para una variable ordinal (sabor_score)
\dontrun{
resultados_calidad <- run_analysis(
  var_name = "sabor_score",
  data = df_ejemplo,
  formula = ~ genotipo, # Kruskal-Wallis se aplica a términos individuales
  response_type = "ordinal"
)
print(resultados_calidad$ordinal_results$kruskal_wallis_table)
}

}
